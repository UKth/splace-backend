// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  userId         Int        @id @default(autoincrement())
  username       String     @unique
  name           String     @db.VarChar(255)
  email          String     @db.VarChar(255)
  password       String     @db.VarChar(255)
  profileMessage String?    @db.VarChar(255)
  profileImageUrl   String?    @db.VarChar(255)
  joinedAt       DateTime   @default(now())
  updatedAt      DateTime   @updatedAt
  authority      String     @db.VarChar(255) @default("user")
  currentLog   Decimal? @db.Decimal(11, 8)
  currentLat   Decimal? @db.Decimal(11, 8)
  credit       Int    @default(0)
  lockedCredit  Int   @default(0)  
  
  followers      User[]     @relation("followRelation")
  
  followings     User[]     @relation("followRelation")
  
  folders        Folder[]  @relation("folderRelation")
  
  photologs      Photolog[]
  
  likedPhotologs Photolog[] @relation("likedRelation")
  
  Series         Series[]

  scraps       Scrap[]

  comments     Comment[]

  likedComments Comment[] @relation("likedCommentRelation")

  messages  Message[]

  chatrooms Chatroom[]
}

model Photolog {
  photologId Int       @id @default(autoincrement())
  title String @db.VarChar(255)
  imageUrls  String[]  @db.VarChar(255)
  photoSize  Int
  text       String?    @db.Text
  createdAt  DateTime  @default(now())
  updatedAt      DateTime   @updatedAt
  
  author       User      @relation(fields: [authorId], references: [userId])
  authorId     Int
  
  splace     Splace?    @relation(fields: [splaceId], references: [splaceId])
  splaceId   Int?
  
  series     Series[]    @relation("seriesRelation")
  
  hashtags   Hashtag[]
  
  likedUser  User[]    @relation("likedRelation")

  scrap Scrap[]

  comments Comment[]
}

model Series {
  seriesId  Int        @id @default(autoincrement())
  title     String     @db.VarChar(255)
  createdAt DateTime   @default(now())
  updatedAt      DateTime   @updatedAt
  
  author      User       @relation(fields: [authorId], references: [userId])
  authorId    Int
  
  photologs Photolog[]   @relation("seriesRelation")
}

model Splace {
  splaceId Int     @id @default(autoincrement())
  name     String  @db.VarChar(255)
  geolog   Decimal? @db.Decimal(11, 8)
  geolat   Decimal? @db.Decimal(11, 8)
  address        String?   @db.VarChar(255)
  createdAt   DateTime @default(now())
  updatedAt      DateTime   @updatedAt
  ownerId Int?
  
  timeSets   TimeSet[]

  items           Item[]
  
  badges         Badge[]
  
  ratingtags    Ratingtag[]   
  
  hashtags      Hashtag[]
  
  fixedContents FixedContent[]
  
  photologs Photolog[]
  
  saves       Save[]
}

model TimeSet {
  timeSetId Int @id @default(autoincrement())
  open DateTime  @db.Time()
  close DateTime @db.Time()
  day Int
  splace Splace? @relation(fields: [splaceId], references: [splaceId])
  splaceId  Int?
}

model FixedContent {
  fixedContentId Int      @id @default(autoincrement())
  title          String   @db.VarChar(255)
  imageUrl       String?   @db.VarChar(255)
  createdAt      DateTime @default(now())
  updatedAt      DateTime   @updatedAt
  text           String?  @db.Text
  
  splace         Splace?   @relation(fields: [splaceId], references: [splaceId])
  splaceId       Int?
}

model Ratingtag {
  ratingtagId Int      @id @default(autoincrement())
  name        String   @db.VarChar(255) @unique
  
  splaces      Splace[]
}

model Badge {
  badgeId Int      @id @default(autoincrement())
  name    String   @db.VarChar(255) @unique
  
  splaces  Splace[]
}

model Save {
  saveId    Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  
  splace    Splace?   @relation(fields: [splaceId], references: [splaceId])
  splaceId  Int?
  
  folder    Folder?   @relation(fields: [folderId], references: [folderId])
  folderId  Int?
}

model Scrap {
  scrapId    Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  
  photolog    Photolog?   @relation(fields: [photologId], references: [photologId])
  photologId  Int?
  
  savedUser User? @relation(fields: [savedUserId], references: [userId])
  savedUserId Int?
}

model Folder {
  folderId  Int      @id @default(autoincrement())
  title     String   @db.VarChar(255)
  createdAt DateTime @default(now())
  updatedAt      DateTime   @updatedAt
  
  members   User[] @relation("folderRelation")
  
  saves     Save[]
}

model Hashtag {
  hashtagId Int @id @default(autoincrement())
  name     String   @db.VarChar(255) @unique
  
  photologs Photolog[]
  
  splaces   Splace[]
}

model Item {
  itemId Int @id @default(autoincrement())
  
  splace Splace @relation(fields: [splaceId], references: [splaceId])
  splaceId Int
}


model Comment {
  commentId Int @id @default(autoincrement())
  
  text String @db.Text
  createdAt DateTime @default(now())
  updatedAt      DateTime   @updatedAt

  author User? @relation(fields: [authorId], references: [userId])
  authorId Int?

  likedUsers User[] @relation("likedCommentRelation")

  photolog Photolog? @relation(fields: [photologId], references: [photologId])
  photologId Int?
}

model PaymentLog {
  paymentLogId Int @id @default(autoincrement())

  customerId Int
  merchantUId String @db.VarChar(255) @unique
  credit Int

  creditGiven Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt      DateTime   @updatedAt
}

model BuyLog {
  buyLogId Int @id @default(autoincrement())

  itemId Int
  shopId Int
  credit Int

  createdAt DateTime @default(now())
  updatedAt      DateTime   @updatedAt
}

model Chatroom {
  chatroomId Int @id @default(autoincrement())
  title String   @db.VarChar(255)
  users User[]
  message Message[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

model Message {
  messageId Int @id @default(autoincrement())
  text String   @db.Text
  author User @relation(fields: [authorId], references: [userId])
  authorId Int

  chatroom Chatroom @relation(fields: [chatroomId], references: [chatroomId])
  chatroomId Int

  createdAt DateTime  @default(now())
}